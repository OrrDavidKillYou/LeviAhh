<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Levi Zelkind Game</title>
  <link rel="icon" type="image/png" href="https://media.licdn.com/dms/image/v2/C4D03AQEm2kirCmJrSw/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1596303540574?e=2147483647&v=beta&t=hxX0K6_OQZJg3JuudGopV43JEVZiEX_zxBpUvoo_Gxo">

  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      margin: 0;
      background-color: #022F2E;
      font-family: Arial, sans-serif;
      color: #36F7F3;
    }

    #header {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    #header img {
      width: 50px;
      height: 50px;
      margin-left: 10px;
      border-radius: 50%;
    }

    #gameCanvas {
      background: #0F172B;
      border: 2px solid black;
      margin-top: 10px;
    }

    #message {
      margin-top: 20px;
      font-size: 50px;
      font-weight: bold;
      color: green;
      text-align: center;
    }

    .niga {
      color: crimson;
      font-size: 50px;
      margin-top: 20px;
    }

    #highscore {
      margin-top: 10px;
      font-size: 30px;
      color: yellow;
    }
  </style>
</head>
<body>
  <div id="header">
    <h1>Levi Zelkind Game</h1>
    <img src="https://media.licdn.com/dms/image/v2/C4D03AQEm2kirCmJrSw/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1596303540574?e=2147483647&v=beta&t=hxX0K6_OQZJg3JuudGopV43JEVZiEX_zxBpUvoo_Gxo" alt="Profile">
  </div>

  <h2>Score: <span id="score">0</span> | Time: <span id="time">30</span>s</h2>
  <div id="highscore">High Score: 0</div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="message">Press ENTER to start</div>
  <a href="index.html" class="niga">to main page</a>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js"></script>

  <script>
    // ðŸ”‘ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const timeDisplay = document.getElementById("time");
    const message = document.getElementById("message");
    const highscoreDisplay = document.getElementById("highscore");

    const player = new Image();
    player.src = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSu5zSvKPUaZZGQzWcLE45xgBT3pxEYLlu2wQ&s";

    let x, y;
    const speed = 10;
    const imgSize = 80;

    const fruits = [
      "https://i.imgur.com/4uwJAMo.jpeg",
      "https://i.imgur.com/ZHJMphT.jpeg",
      "https://i.imgur.com/pbYA8AB.jpeg",
      "https://i.imgur.com/jEFcDfE.jpeg",
      "https://i.imgur.com/5qMpg45.jpeg",
      "https://i.imgur.com/jNDl6cg.jpeg",
      "https://i.imgur.com/WC5rwH4.jpeg",
      "https://i.imgur.com/t20Ak5b.jpeg",
      "https://i.imgur.com/0cPP22V.png",
      "https://i.imgur.com/Y0xO0n8.png"
    ];

    let fruitImg = new Image();
    let fruitX, fruitY;
    const fruitSize = 60;

    let score, timeLeft, gameOver, timer;
    let highScore = 0;

    // --------------------
    // Fetch High Score from Firebase
    // --------------------
    function updateHighScoreDisplay() {
      highscoreDisplay.textContent = "High Score: " + highScore;
    }

    function fetchHighScore() {
      db.ref('highScore').once('value').then(snapshot => {
        highScore = snapshot.val() || 0;
        updateHighScoreDisplay();
      });
    }

    function saveHighScore(score) {
      if(score > highScore){
        highScore = score;
        db.ref('highScore').set(score);
        updateHighScoreDisplay();
      }
    }

    // --------------------
    // Game Functions
    // --------------------
    function resetGame() {
      x = 100;
      y = 100;
      score = 0;
      timeLeft = 45;
      gameOver = false;

      scoreDisplay.textContent = score;
      timeDisplay.textContent = timeLeft;
      message.textContent = "";

      newFruit();
      draw();
      startTimer();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(fruitImg, fruitX, fruitY, fruitSize, fruitSize);
      ctx.drawImage(player, x, y, imgSize, imgSize);
    }

    function newFruit() {
      fruitImg.src = fruits[Math.floor(Math.random() * fruits.length)];
      fruitX = Math.random() * (canvas.width - fruitSize);
      fruitY = Math.random() * (canvas.height - fruitSize);
    }

    function checkCollision() {
      if (
        x < fruitX + fruitSize &&
        x + imgSize > fruitX &&
        y < fruitY + fruitSize &&
        y + imgSize > fruitY
      ) {
        score++;
        scoreDisplay.textContent = score;
        timeLeft++;
        timeDisplay.textContent = timeLeft;
        newFruit();
      }
    }

    function startTimer() {
      clearInterval(timer);
      timer = setInterval(() => {
        if(timeLeft > 0){
          timeLeft--;
          timeDisplay.textContent = timeLeft;
        } else {
          clearInterval(timer);
          gameOver = true;
          message.textContent = `Game Over! You scored ${score} points! ðŸŽ‰ Press ENTER to play again.`;
          saveHighScore(score);
        }
      }, 1000);
    }

    // --------------------
    // Event Handling
    // --------------------
    document.addEventListener("keydown", function(event){
      if(event.key === "Enter" && (gameOver || timeLeft === undefined)){
        resetGame();
        return;
      }

      if(gameOver) return;

      if(event.key === "ArrowUp") y -= speed;
      if(event.key === "ArrowDown") y += speed;
      if(event.key === "ArrowLeft") x -= speed;
      if(event.key === "ArrowRight") x += speed;

      if(x < 0) x = 0;
      if(y < 0) y = 0;
      if(x + imgSize > canvas.width) x = canvas.width - imgSize;
      if(y + imgSize > canvas.height) y = canvas.height - imgSize;

      checkCollision();
      draw();
    });

    player.onload = function() {
      message.textContent = "Press ENTER to start";
    };

    // Fetch high score when page loads
    fetchHighScore();
  </script>
</body>
</html>
